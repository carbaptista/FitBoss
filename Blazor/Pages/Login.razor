@page "/login"
@using Blazor.Interfaces;
@using Domain.Request_Models.Employees;
@inject IAuthService AuthService
@inject NavigationManager NavigationManager

<EditForm Model="loginModel" OnValidSubmit="HandleLogin">
    <DataAnnotationsValidator />
    <RadzenCard class="rz-my-12 rz-mx-auto rz-p-4 rz-p-md-12" style="max-width: 600px;">
        <RadzenText TextStyle="TextStyle.H4">Login</RadzenText>
        <RadzenText TextStyle="TextStyle.Subtitle1">Insira suas credenciais</RadzenText>
        <span class="text-danger">@Error</span>
        <RadzenText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3">Usuário</RadzenText>
        <RadzenTextBox @bind-Value="loginModel.UserName" class="w-100" />
        <ValidationMessage For="@(() => loginModel.UserName)" />

        <RadzenText TextStyle="TextStyle.Subtitle2" TagName="TagName.H3" class="mt-3">Senha</RadzenText>
        <RadzenPassword @bind-Value="loginModel.Password" class="w-100" />
        <ValidationMessage For="@(() => loginModel.Password)" />

        <RadzenButton Text="Entrar" ButtonStyle="ButtonStyle.Primary" ButtonType="ButtonType.Submit" class="mt-3" />
    </RadzenCard>
</EditForm>

@code {
    private EmployeeLoginModel loginModel = new();
    private string Error = "";

    private async Task HandleLogin()
    {
        var result = await AuthService.Login(loginModel);

        if (result.Success)
        {
            NavigationManager.NavigateTo("/");
        }
        else
        {
            Error = result.Error;
        }
    }
}